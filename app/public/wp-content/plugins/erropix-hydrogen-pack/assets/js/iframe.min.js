function HydrogenPack(e,B,D){var t=angular.element(document),a=angular.element("body"),n=angular.element("#ct-builder"),o=angular.element("#oxygen-resize-box"),R=B.component.active,b=a.hasClass("ct_connection_active"),F={clipboard:"",canSaveReusable:!1,canSaveBlock:!1,canReadClipboard:!1,canWrapLink:!1,getComponentObject:G},H=["savePage","switchCodeBlockTabs"],U=["cut","moveUp","moveDown","rename","changeId","showConditions","duplicate","saveReusable","saveBlock","wrap","delete","editContent"],z=["ct_id","ct_parent","ct_content","source_id","nicename","selector","activeselector"],N=["href","url","target","globalConditionsResult","globalconditions","use-custom","custom-code","code-php","code-css","code-js","full_shortcode","embed_src","src","image_type","attachment_height","attachment_id","attachment_size","attachment_url","attachment_width","icon-id"];function W(e){return parent.angular.element(e)}function $(e){try{var t=JSON.stringify(e);return btoa(unescape(encodeURIComponent(t)))}catch(e){console.error(e)}return""}function X(e){return!e.$$phase&&(e.$digest(),1)}function J(e){setTimeout(function(){B.showNoticeModal("<div>"+e+"</div>"),X(B)},100)}function K(){var e=B.getActiveComponent();e.length&&(e.addClass("hydrogen-flash"),setTimeout(function(){e.removeClass("hydrogen-flash")},1100))}function Y(){var n=[];return function t(e){e.forEach(function(e){e.id<1e5?n.push(e):e.children&&t(e.children)})}(B.componentsTree.children),n}function G(n){var o=null;return function e(t){void 0!==t.id&&t.id==n?o=t:t.children&&t.children.forEach(e)}(B.componentsTree),o}function Z(e){var n={};function o(e){var t=e.id;B.componentsClasses.hasOwnProperty(t)&&B.componentsClasses[t].forEach(function(e){n.hasOwnProperty(e)||B.classes.hasOwnProperty(e)&&(n[e]=B.classes[e])}),e.children&&e.children.forEach(o)}return e.constructor==Array?e.forEach(o):o(e),n}function q(e,t){var i={};function c(e){for(key in e)if(e.hasOwnProperty(key)){var t=e[key];if("string"==typeof t){var n=t.match(/color\((\d+)\)/);if(n){var o=n[1];if(i.hasOwnProperty(o))return;var a=B.getGlobalColor(o);a&&(i[o]=_.pick(a,"id","name","value"))}}"object"==typeof t&&c(t)}}return c(e),c(t),i}function Q(e,t){for(key in"object"!=typeof B.styleFolders[t]&&(B.styleFolders[t]={status:1,key:t}),e)e[key].parent=t;B.classes=Object.assign(e,B.classes),B.classesCached=!1}function V(e,t,n,o){var a={},i=B.globalColorSets,c=_.findWhere(i.sets,{name:o});function s(e,t){return"color("+a[parseInt(t)]+")"}function r(o){_.each(o,function(e,t){var n=/color\((\d*)\)/g;"string"==typeof e&&n.test(e)?o[t]=e.replace(n,s):"object"==typeof e&&r(o[t])})}return"object"!=typeof c&&(c={id:++i.setsIncrement,name:o},i.sets.push(c)),_.each(e,function(e){var t=_.findWhere(i.colors,{name:e.name,set:c.id});"object"!=typeof t&&(t={id:++i.colorsIncrement,name:e.name,value:e.value,set:c.id},i.colors.push(t)),a[e.id]=t.id}),r(t),r(n),a}function ee(e){!function e(t){if("ct_image"==t.name){var n=t.options.original;if(n.attachment_url)for(var o in"2"==n.image_type&&(delete n.image_type,n.src=n.attachment_url),n)0==o.indexOf("attachment_")&&delete n[o]}t.children&&t.children.forEach(e)}(e)}function te(){return!D.isActiveActionTab("contentEditing")&&(1e5<R.id?-1:0<R.id||0)}function ne(e,t){return 0==["ct_link","ct_link_button","ct_link_text","ct_widget","ct_shortcode","ct_code_block"].includes(e)&&"oxy_dynamic_list"!==t}function oe(){var e=_.values(arguments),t=e.shift(),n=te();if(!1===n&&!H.includes(t))return!1;if(!0!==n&&U.includes(t))return!1;var o=!0,a=R.id,i=R.name,c=R.parent;switch(t){case"copy":if(o=!1,hydrogen.get("settings.clipboard.enabled")){var s=[];if(0<a&&a<1e5?s.push(G(a)):s=Y(),s.length){var r=q(s,m=Z(s));(l=$(p={source:hydrogen.get("siteUrl"),component:s,classes:m,colors:r}))&&(hydrogen.get("settings.clipboard.flashCopiedComponent")&&K(),ae(l),o=l)}o||J("Can not copy the element to clipboard")}break;case"copyStyle":if(o=!1,hydrogen.get("settings.clipboard.enabled")){if(h=G(a)){r=q(v=angular.copy(h.options),m=Z({id:a}));(y=_.omit(v,z)).original=_.omit(y.original,N),y.classes=y.classes||[],y.currentClass=B.currentClass,(l=$(p={source:hydrogen.get("siteUrl"),style:y,classes:m,colors:r}))&&(hydrogen.get("settings.clipboard.flashCopiedComponent")&&K(),ae(l),o=l)}o||J("Can not copy style to clipboard")}break;case"copyConditions":if(o=!1,hydrogen.get("settings.clipboard.enabled"))if(h=G(a)){var l,d=hydrogen.get("options.original.globalconditions",null,h);if(d)(l=$(p={conditions:d,conditionstype:hydrogen.get("options.original.conditionstype","",h)}))&&(hydrogen.get("settings.clipboard.flashCopiedComponent")&&K(),ae(l),o=l);else J("There are no conditions to copy")}else J("Can not copy conditions to clipboard");break;case"cut":o=!1,hydrogen.get("settings.clipboard.enabled")&&oe("copy")&&(B.removeComponentById(a,i,c.id),o=!0);break;case"paste":if(o=!1,hydrogen.get("settings.clipboard.enabled")){if(!F.clipboard)throw new Error("The clipboard is empty");var p;if((p=function(e){try{var t=decodeURIComponent(escape(atob(e)));return JSON.parse(t)}catch(e){console.error(e)}return!1}(F.clipboard)).constructor!==Object)throw new Error("Invalid clipboard contents");if("object"==typeof p.component){var u=p.source,h=p.component;if(u&&u!==hydrogen.get("siteUrl")){hydrogen.get("settings.clipboard.processMediaImages")&&ee(h);var g=hydrogen.get("settings.clipboard.colorSet","Copied Colors"),b=hydrogen.get("settings.clipboard.folder","Copied Classes"),m=p.classes;V(r=p.colors,h,m,g),Q(m,b)}var f={id:0,depth:0,name:"root",children:[]};Array.isArray(h)?f.children=h:f.children.push(h),D.showLoadingOverlay(),setTimeout(function(){B.addReusableChildren(f,null,a),D.hideLoadingOverlay(),hydrogen.get("settings.clipboard.keepActiveComponent")&&B.activateComponent(a,i)}),o=!0}if("object"==typeof p.style){if(!0!==n)throw new Error("Can not apply styles! The selected element is invalid");if(h=G(a)){u=p.source;var y,v=h.options,C=(y=p.style).currentClass;if(u&&u!==hydrogen.get("siteUrl")){g=hydrogen.get("settings.clipboard.colorSet","Copied Colors"),b=hydrogen.get("settings.clipboard.folder","Copied Classes"),m=p.classes;V(r=p.colors,y,m,g),Q(m,b)}_.extend(y.original,_.pick(v.original,N)),_.extend(y,_.pick(v,z)),delete y.currentClass,h.options=y,B.component.options[a]=_.pick(B.component.options[a],z),B.componentsClasses[a]=y.classes;var k=a;"ct_span"==i&&(k=c.id),B.rebuildDOM(k),C?B.setCurrentClass(C):B.switchEditToId(!0),B.adjustResizeBox(),o=!0}}if("object"==typeof p.conditions){if(!0!==n)throw new Error("Can not apply conditions! The selected element is invalid");(h=G(a))&&(B.setOptionModel("globalconditions",p.conditions,a,i),B.setOptionModel("conditionstype",p.conditionstype,a,i),o=!0)}}break;case"moveUp":if((x=G(c.id).children)&&1<x.length){var w=0;if(x.forEach(function(e,t){e.id==a&&(w=t)}),0<w){var T=x[w];x.splice(w,1),x.splice(--w,0,T),B.rebuildDOM(c.id),B.updateDOMTreeNavigator()}}break;case"moveDown":var x;if((x=G(c.id).children)&&1<x.length){w=0;var S=x.length-1;if(x.forEach(function(e,t){e.id==a&&(w=t)}),w<S){T=x[w];x.splice(w,1),x.splice(++w,0,T),B.rebuildDOM(c.id),B.updateDOMTreeNavigator()}}break;case"rename":var E=(v=B.component.options[a]).nicename||"";(E=prompt("Enter the new element name",E))?(E=E.replace(/["']+/g,"").trim())?(v.nicename=E,B.updateFriendlyName(a)):J("Invalid name given!"):null!==E&&J("Name can not be empty!");break;case"changeId":var A=(v=B.component.options[a]).selector||"";(A=prompt("Enter the new element id",A))?(A=A.replace(/[^\w\-_]+/g,"").trim())?(v.selector=A,B.setOption(a,i,"selector")):J("Invalid ID given!"):null!==A&&J("ID can not be empty!");break;case"showConditions":D.showConditionsMenu=!1,D.dialogForms.ifCondition=!0,D.showDialogWindow(),X(D);break;case"clearConditions":B.clearConditions();break;case"componentBrowser":D.switchActionTab("componentBrowser"),setTimeout(function(){D.resetComponentsSearch()});break;case"addComponent":e.length&&B.addComponent.apply(null,e);break;case"switchAdvancedTab":e.length&&(D.showAllStylesFunc(),D.styleTabAdvance=!0,e.unshift("advanced"),D.switchTab.apply(null,e),X(D));break;case"switchCodeBlockTabs":o=!1,D.isActiveName("ct_code_block")&&(D.isShowTab("advanced","code-php")?D.switchTab("advanced","code-css"):D.isShowTab("advanced","code-css")?D.switchTab("advanced","code-js"):(D.isShowTab("advanced","code-js")||(D.showAllStylesFunc(),D.styleTabAdvance=!0),D.switchTab("advanced","code-php")),o=!0,X(D));break;case"applyCode":D.isShowTab("advanced","code-php")?B.applyCodeBlockPHP():D.isShowTab("advanced","code-css")?B.applyCodeBlockCSS():D.isShowTab("advanced","code-js")?B.applyCodeBlockJS():D.isShowTab("advanced","custom-js")?B.applyComponentJS():D.isShowTab("advanced","custom-css")?B.applyComponentCSS():o=!1;break;case"toggleLeftSidebar":var O=D.showLeftSidebar;"boolean"==typeof O&&(O?D.doHideLeftSidebar(!0):D.doShowLeftSidebar(!0));break;case"toggleSettingsPanel":D.toggleSettingsPanel();break;case"switchTab":e.length&&D.switchTab.apply(null,e);break;case"switchSettingsTab":e.length&&(e.unshift("settings"),D.switchTab.apply(null,e),D.toggleSettingsPanel(!0));break;case"switchSettingsChildTab":e.length&&(e.unshift("settings"),D.tabs.settings=[],D.switchChildTab.apply(null,e),D.toggleSettingsPanel(!0));break;case"setMedia":if(e.length){var P=e[0],j=B.getCurrentMedia();if("number"==typeof P){var I=Object.keys(iframeScope.mediaList);if(!(0<=(w=I.indexOf(j)-P)&&w<I.length))break;P=I[w]}else if(j==P)break;B.setCurrentMedia(P,!0,B.isEditing("class"))}break;case"duplicate":B.duplicateComponent(a,i,c.id);break;case"saveReusable":B.saveReusable(a);break;case"saveBlock":B.saveReusable(a,!0);break;case"wrap":B.wrapComponentWith("ct_div_block",a,c.id);break;case"wrapLink":o=!1,ne(i,c.name)&&(B.wrapComponentWith("ct_link",a,c.id),o=!0);break;case"delete":B.removeComponentWithUndo(a,i,c.id);break;case"activateParent":"number"==typeof c.id&&(1e5<c.id&&(c.id=0,c.name="root"),B.activateComponent(c.id,c.name));break;case"editContent":o=!1;var M=B.getActiveComponent();M&&M.get(0).hasAttribute("contenteditable")&&(D.enableContentEdit(M),o=!0);break;case"switchTextComponent":if("ct_text_block"==i||"oxy_rich_text"==i)i="ct_text_block"==i?"oxy_rich_text":"ct_text_block",R.name=i,(h=G(a)).name=i,B.rebuildDOM(a),B.updateBreadcrumbs(a);break;case"savePage":B.savePage();break;case"openBackend":(L=W("#oxygen-topbar .oxygen-back-to-wp-menu a").first().prop("href"))&&window.open(L,"_blank");break;case"openFrontend":var L;w=B.ajaxVar.ctTemplate?2:1;(L=W("#oxygen-topbar .oxygen-back-to-wp-menu a").eq(w).prop("href"))&&window.open(L,"_blank");break;default:o=!1}return X(B),o}if(B.hydroScope=F,D.hydroScope=F,hydrogen.get("settings.contextMenu.enabled")){var m=e.children("#hydrogen-contextual-menu"),i=m.children("[data-command]"),f=null;function c(){f=null,m.hide(),m.css("left",0),m.css("top",0)}function s(e,t,n,o){if(te()){d=R.id,p=R.name,u=R.parent,h=G(d),g=hydrogen.get("options.original.globalconditions",null,h),F.hasConditions=g&&0<g.length,F.canSaveReusable=B.isCanComponentize(d,p),F.canSaveBlock=b&&["ct_section","ct_div_block"].includes(p),F.canWrapLink=ne(p,u.name),F.isTextComponent=["ct_text_block","oxy_rich_text"].includes(p),F.isTextComponent?F.convertTextLabel="ct_text_block"==p?"rich text":"text block":F.convertTextLabel="",F.canReadClipboard&&navigator.clipboard.readText().then(function(e){e&&/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/.test(e)&&(F.clipboard=e,X(B))}),X(B),m.show();var a=document.documentElement.clientWidth,i=document.documentElement.clientHeight;(n=n||0)<a&&(n=0),(o=o||0)<i&&(o=0);var c=m.width(),s=m.height(),r=n+window.scrollX+a-c-2,l=o+window.scrollY+i-s-2;return m.css("left",Math.min(e,r)),m.css("top",Math.min(t,l)),f=R.id,1}var d,p,u,h,g}m.on("click mousedown mouseup touchstart",!1),t.on("click",c),t.on("contextmenu",function(e){if(0<=e.pageX&&0<=e.pageY)c();else if(te()){var t=B.rbTitleBar.offset();if(t){var n=t.left+1,o=t.top+1,a=B.getActiveComponent();return D.scrollToComponent(a.attr("id")),s(n,o,t.left,t.top),!1}}}),n.on("contextmenu",function(e){if(s(e.pageX+1,e.pageY+1))return!1}),o.on("contextmenu",function(e){if(s(e.pageX+1,e.pageY+1))return!1}),i.on("click",function(){var e=this.dataset.command;!this.classList.contains("disabled")&&e&&(setTimeout(function(){try{oe(e)}catch(e){console.error(e),J("Failed to execute the command<br/>"+e)}},10),c())}),B.$watch("component.active.id",function(){f&&f!=R.id&&c()})}if(hydrogen.get("settings.clipboard.enabled")){function ae(e){if(e){F.clipboard=e;var t=document.getElementById("hydrogen-clipboard-input");return t.value=e,t.focus(),t.select(),document.execCommand("copy"),setTimeout(function(){t.value="",t.setSelectionRange(0,0),t.blur()}),1}}function r(e){if(!1!==te()){try{F.clipboard=e.originalEvent.clipboardData.getData("Text").trim(),oe("paste")}catch(e){console.error(e),J("Failed to process the clipboard contents<br/>"+e)}e.stopPropagation(),e.preventDefault()}}navigator.permissions&&navigator.clipboard&&navigator.permissions.query({name:"clipboard-read"}).then(function(e){e.onchange=function(){F.canReadClipboard="denied"!==this.state},e.onchange()}).catch(function(){console.warn("Clipboard API is not supported in this browser")}),n.on("paste","[contenteditable]",function(e){this.isContentEditable||(e.stopImmediatePropagation(),r(e))}),a.on("paste",r),F.pasteHandler=r}if(hydrogen.get("settings.shortcuts.enabled")){var l=[];function d(e){var t=[];return e.key&&(e.ctrl&&t.push("ctrl"),e.alt&&t.push("alt"),e.shift&&t.push("shift"),t.push(e.key.toLowerCase())),t.join("+")}function p(e){var t=!1;if(0==e.originalEvent.repeat){var n=d({ctrl:e.ctrlKey||e.metaKey,alt:e.altKey,shift:e.shiftKey,key:e.key});if(n){var o=_.findWhere(l,{shortcut:n});o&&0<o.arguments.length&&function(e,t){if(0==H.includes(t)){var n=e.target;if(n&&(n.isContentEditable||["INPUT","TEXTAREA"].includes(n.nodeName)))return;if(D.isActiveActionTab("contentEditing"))return}return 1}(e,o.arguments[0])&&(t=oe.apply(this,o.arguments))}}t&&(e.stopImmediatePropagation(),e.preventDefault())}!function(){var e=hydrogen.get("settings.shortcuts.hotkeys");if("object"==typeof e){var n=!1,o=["arrowleft","arrowright"];_.each(e,function(e,t){e.key&&e.arguments&&(l.push({id:t,shortcut:d(e),arguments:_.values(e.arguments)}),0==n&&o.includes(e.key)&&(n=!0))}),n&&a.on("keyup",function(e){if(37==e.which||39==e.which)return!1})}}(),a.on("keydown",p),F.shortcutHandler=p}hydrogen.get("settings.disableEditLocking.enabled")&&(B.setPostEditLockTransient=function(){}),hydrogen.get("settings.conditionsEnhancer.enabled")&&(B.clearConditions=function(){var e=R.id,t=R.name;B.setOptionModel("conditionstype",void 0,e,t,!0),B.setOptionModel("globalconditions",void 0,e,t,!0),D.evalGlobalConditions(),D.evalGlobalConditionsInList()}),hydrogen.get("settings.advancedStylesReset.enabled")&&(jQuery.extend(!0,B.optionsHierarchy,{background:{gradient:["gradient"]},"background-gradient":{gradient:["gradient"]},"custom-css":{"custom-css":["custom-css"]},"custom-js":{"custom-js":["custom-js"]}}),B.clearTabOptions=function(e,t){e.stopPropagation(),e.preventDefault();var n=B.component.active.id,o=B.component.active.name,a=B.component.options,i=B.optionsHierarchy[t];"object"==typeof i&&_.each(i,function(e){_.each(e,function(e){a[n]&&a[n].model[e]&&(B.setOptionModel(e,void 0,n,o),!B.isEditing("id")||B.isEditing("media")||B.isEditing("state")||(a[n].id[e]=void 0))})})}),hydrogen.get("settings.dynamicClasses.enabled")&&(B.optionsHierarchy&&(B.optionsHierarchy["dynamic-classes"]={"dynamic-classes":["dynamic-classes"]}),B.addDynamicClass=function(){var e="dynamic-classes",t=B.getOption(e);Array.isArray(t)||(t=[]),t.push({value:"",notes:"",sanitize:!1}),B.setOptionModel(e,t)},B.removeDynamicClass=function(e,t){var n="dynamic-classes",o=B.getOption(n);o.splice(t,1),B.setOptionModel(n,o)},B.insertShortcodeToDynamicClass=function(e,t){dynamicClass="dyndata_"+btoa(unescape(encodeURIComponent(e))),B.setOptionModel(t,dynamicClass)}),hydrogen.get("settings.classLock.enabled")&&(B.isClassLocked=function(e){return(e=e||B.currentClass)&&hydrogen.get(e+".locked",!1,B.classes)},B.lockClass=function(e,t){B.classes[e].locked=!0,e==B.currentClass&&B.switchEditToId(!0),t.stopPropagation()},B.unlockClass=function(e,t){B.classes[e].locked=!1,t.stopPropagation()}),hydrogen.get("settings.preserveAdvancedTabs.enabled")&&function(){var o=!0,a=!1,i=B.activateComponent;B.activateComponent=function(e,t,n){"ct_inner_content"==t&&(D.styleTabAdvance=!0),o&&(a=D.styleTabAdvance),i.call(null,e,t,n),o=0<e&&(D.styleTabAdvance=a,!0)};var t=B.setCustomSelectorToEdit;B.setCustomSelectorToEdit=function(e){t.call(null,e),e&&(D.styleTabAdvance=!0)}}()}"object"!=typeof hydrogen&&(hydrogen={}),angular.extend(hydrogen,{get:function(e,t,n){var o;n=n||this;return void 0===(o=e.split(".").filter(function(e){return e}).reduce(function(e,t){return e&&e[t]},n))&&(o=t),o},onFunction:function(e,t,n){var o=setInterval(function(){"function"==typeof e[t]&&(n.call(),clearInterval(o))},50)}}),CTFrontendBuilder.directive("hydrogenPack",["$parentScope",function(n){return{restrict:"A",link:function(e,t){window.HydrogenPack=new HydrogenPack(t,e,n)}}}]),hydrogen.get("settings.classLock.enabled")&&CTFrontendBuilder.directive("oxygenResizeBox",["$compile",function(e){return{restrict:"AE",template:function(e){e.append("<div ng-class=\"{'oxygen-resize-box-class-locked': isClassLocked()}\"></div>")}}}]);